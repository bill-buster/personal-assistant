#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-commit hook: Auto-cleanup, fix formatting, and check before commit

echo "ğŸ” Pre-commit checks..."

# 1. Clean up generated files
echo "  Cleaning up generated files..."
npm run cleanup > /dev/null 2>&1 || true

# 2. Auto-fix formatting and linting
echo "  Auto-fixing formatting and linting..."
npm run fix > /dev/null 2>&1 || {
    echo "  âš ï¸  Some issues couldn't be auto-fixed. Please review:"
    npm run fix
    exit 1
}

# 3. Check formatting (fail if still has issues)
echo "  Checking formatting..."
npm run format:check > /dev/null 2>&1 || {
    echo "  âŒ Formatting issues found. Run: npm run fix"
    npm run format:check
    exit 1
}

# 4. Check linting
echo "  Checking linting..."
npm run lint > /dev/null 2>&1 || {
    echo "  âŒ Linting issues found. Run: npm run lint:fix"
    npm run lint
    exit 1
}

# 5. Type check
echo "  Type checking..."
npm run typecheck > /dev/null 2>&1 || {
    echo "  âŒ Type errors found. Please fix."
    npm run typecheck
    exit 1
}

echo "  âœ… Pre-commit checks passed!"
echo ""
