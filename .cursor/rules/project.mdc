---
description: Project overview and high-level context for AI assistance
globs: []
alwaysApply: true
---

# Personal Assistant - Project Context

## What This Is

A **local-first CLI assistant** that:
1. Takes natural language commands
2. Routes them to tools (regex → heuristic → LLM fallback)
3. Executes tools with security sandboxing
4. Returns structured results

## Key Files to Know

| File | Purpose | When to Read |
|------|---------|--------------|
| `src/app/cli.ts` | CLI entry point | Adding commands |
| `src/app/router.ts` | Intent routing | Adding patterns |
| `src/core/executor.ts` | Tool execution + security | Security changes |
| `src/core/types.ts` | All type definitions | Adding types |
| `src/runtime/runtime.ts` | Dependency injection | Wiring changes |
| `src/tools/schemas.ts` | Tool specifications | Adding tools |

## Common Tasks

### Adding a New Tool
1. Schema in `src/core/types.ts`
2. Handler in `src/tools/*.ts`
3. Register in `src/core/tool_registry.ts`
4. Add to agents in `src/agents/index.ts`
5. (Optional) Router pattern in `src/app/router.ts`

### Adding a CLI Command
1. Add case in `src/app/cli.ts` switch statement
2. Create handler function
3. Route through `routeAndExecute()` if it maps to a tool

### Modifying Security
1. Path checks in `src/core/executor.ts`
2. Permissions schema in `src/core/types.ts`
3. Tests in `src/permissions.test.ts`

## Architecture Decisions

- **No Express/Fastify** - Web server is minimal, built-in
- **No ORM** - JSONL files for storage (local-first)
- **No LangChain** - Custom routing for control
- **Zod everywhere** - Runtime validation at boundaries
- **Fail-closed** - Security denies by default

## Current Limitations

- Single-user only (no auth)
- No streaming responses in CLI
- LLM fallback requires API key
- Max file size 64KB

## Quick Commands

```bash
# Development
npm run dev:watch    # REPL with hot reload
npm run build:watch  # Continuous build
npm run web:watch    # Dashboard with hot reload

# Testing
npm test             # Full suite
npm run smoke        # Quick verification
npm run preflight    # Full checks before commit

# Debugging
npm run doctor       # Check configuration
./dist/app/cli.js --verbose "your command"
```

## Environment Variables

| Variable | Purpose | Default |
|----------|---------|---------|
| `GROQ_API_KEY` | Groq LLM provider | - |
| `OPENROUTER_API_KEY` | OpenRouter provider | - |
| `ASSISTANT_DATA_DIR` | Data storage | `~/.assistant-data` |
| `ASSISTANT_CONFIG_DIR` | Config location | `~/.assistant` |

## Test Data Isolation

Tests use temp directories. Never rely on repo files for test data.
All paths go through `ExecutorContext` which is configured per-test.
